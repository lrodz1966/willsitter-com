<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>QR Scanner</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body { margin: 0; font-family: sans-serif; text-align: center; }
    #reader { width: 100%; max-width: 320px; margin: 20px auto; }
  </style>
</head>
<body>
  <h2>QR Scanner</h2>
  <div id="reader"></div>
  <p id="status" style="color: red;"></p>

  <script>
    let html5QrCode;

    // ‚úÖ Extract clientId from URL
    const urlParams = new URLSearchParams(window.location.search);
    const clientId = urlParams.get("clientId");
    const statusEl = document.getElementById("status");

    if (!clientId) {
      statusEl.textContent = "‚ùå Missing clientId in URL.";
    } else {
      // ‚úÖ Start QR scanner
      html5QrCode = new Html5Qrcode("reader");
      Html5Qrcode.getCameras().then(devices => {
        if (devices && devices.length > 0) {
          const cameraId = devices[0].id;
          html5QrCode.start(
            cameraId,
            { fps: 10, qrbox: { width: 250, height: 250 } },
            (decodedText) => {
              console.log("üì¶ QR code decoded:", decodedText);
              // ‚úÖ Redirect back to dynamic page with QR code
              const redirectUrl = `https://your-wix-site.com/clientprofile/${clientId}?qrcode=${encodeURIComponent(decodedText)}`;
              window.location.href = redirectUrl;
            },
            (errorMessage) => {
              // Ignore scan errors
            }
          ).catch(err => {
            statusEl.textContent = "‚ùå Error starting camera: " + err;
            console.error("‚ùå QR start error:", err);
          });
        }
      }).catch(err => {
        statusEl.textContent = "‚ùå Camera access error: " + err;
        console.error("‚ùå Camera error:", err);
      });
    }
  </script>
</body>
</html>


